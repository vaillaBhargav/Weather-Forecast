<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather Forecast</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #0077b6;
      --primary-light: #48cae4;
      --secondary-color: #00b4d8;
      --text-color: #333;
      --light-text: #f8f9fa;
      --card-bg: rgba(255, 255, 255, 0.92);
      --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      --transition: all 0.3s ease;
      --border-radius: 16px;
    }

    /* Base background styles */
    body {
      font-family: 'Poppins', 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: var(--text-color);
      transition: background 1s ease;
      line-height: 1.6;
      position: relative;
      overflow-x: hidden;
    }

    /* Background overlay for weather effects */
    .weather-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
      overflow: hidden;
    }

    /* Time-based backgrounds */
    .morning {
      background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
    }
    .daytime {
      background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
    }
    .evening {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
    }
    .night {
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
    }

    /* Weather-specific overlays */
    .rainy {
      background: linear-gradient(135deg, rgba(75, 121, 207, 0.9) 0%, rgba(40, 62, 81, 0.9) 100%) !important;
    }
    .cloudy {
      background: linear-gradient(135deg, rgba(189, 195, 199, 0.9) 0%, rgba(44, 62, 80, 0.9) 100%) !important;
    }
    .snowy {
      background: linear-gradient(135deg, rgba(230, 233, 240, 0.9) 0%, rgba(238, 241, 245, 0.9) 100%) !important;
    }
    .thunderstorm {
      background: linear-gradient(135deg, rgba(31, 28, 44, 0.9) 0%, rgba(58, 44, 74, 0.9) 100%) !important;
    }
    .foggy {
      background: linear-gradient(135deg, rgba(200, 200, 200, 0.8) 0%, rgba(150, 150, 150, 0.8) 100%) !important;
    }
    .clear-night {
      background: linear-gradient(135deg, #0a0e24 0%, #1a1b3a 50%, #2d2b4e 100%) !important;
    }

    /* Cloud animations */
    .cloud {
      position: absolute;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      z-index: -1;
      filter: blur(15px);
      animation: moveClouds linear infinite;
    }

    @keyframes moveClouds {
      0% { transform: translateX(-20%); }
      100% { transform: translateX(120%); }
    }

    /* Rain effect */
    .rain {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .drop {
      position: absolute;
      bottom: 100%;
      width: 2px;
      height: 30px;
      background: linear-gradient(transparent, rgba(174, 194, 224, 0.8));
      animation: rain linear infinite;
    }

    @keyframes rain {
      0% { transform: translateY(0) translateX(0); }
      70% { opacity: 1; }
      100% { transform: translateY(100vh) translateX(10px); opacity: 0; }
    }

    /* Snow effect */
    .snow {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .flake {
      position: absolute;
      background: white;
      border-radius: 50%;
      filter: blur(1px);
      animation: snowfall linear infinite;
    }

    @keyframes snowfall {
      0% { transform: translateY(-10px) translateX(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) translateX(20px) rotate(360deg); opacity: 0; }
    }

    /* Lightning effect */
    .lightning {
      position: absolute;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
      z-index: -1;
    }

    /* Fog effect */
    .fog {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .fog-cloud {
      position: absolute;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      filter: blur(30px);
      animation: moveFog linear infinite;
    }

    @keyframes moveFog {
      0% { transform: translateX(-20%); }
      100% { transform: translateX(120%); }
    }

    /* Stars for clear night */
    .stars {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 2s infinite alternate;
    }

    @keyframes twinkle {
      0% { opacity: 0.3; }
      100% { opacity: 1; }
    }

    /* Sun/Moon for clear weather */
    .sun-moon {
      position: absolute;
      border-radius: 50%;
      z-index: -1;
      animation: float 20s infinite linear;
    }

    .sun {
      background: radial-gradient(circle, #ffde59 0%, #ff914d 100%);
      box-shadow: 0 0 50px #ffde59;
    }

    .moon {
      background: radial-gradient(circle, #e6e6e6 0%, #b3b3b3 100%);
      box-shadow: 0 0 30px rgba(230, 230, 230, 0.5);
    }

    @keyframes float {
      0% { transform: translate(-50%, -50%) rotate(0deg) translateX(150px) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg) translateX(150px) rotate(-360deg); }
    }

    .container {
      width: 100%;
      max-width: 1000px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin: 20px 0;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      font-size: 2.5rem;
      font-weight: 600;
    }

    .search-container {
      display: flex;
      width: 100%;
      max-width: 600px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border-radius: 50px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(8px);
      transition: var(--transition);
    }

    .search-container:focus-within {
      box-shadow: 0 4px 25px rgba(0,0,0,0.3);
      transform: translateY(-2px);
    }

    #cityInput {
      flex: 1;
      padding: 15px 25px;
      font-size: 16px;
      border: none;
      outline: none;
      background: transparent;
      color: white;
      font-weight: 500;
    }

    #cityInput::placeholder {
      color: rgba(255, 255, 255, 0.8);
    }

    button {
      padding: 15px 30px;
      font-size: 16px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }

    button:hover {
      background-color: #005f87;
    }

    #result {
      width: 100%;
      margin-top: 20px;
    }

    .location-title {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 30px;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .current-weather {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .current-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 25px;
      gap: 20px;
    }

    .current-temp {
      font-size: 4rem;
      font-weight: 600;
      margin: 0;
      color: var(--text-color);
      line-height: 1;
    }

    .weather-icon-large {
      width: 120px;
      height: 120px;
    }

    .current-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 20px;
      width: 100%;
    }

    .detail-card {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      padding: 18px 15px;
      text-align: center;
      transition: var(--transition);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .detail-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .detail-card i {
      font-size: 1.4rem;
      margin-bottom: 10px;
      color: var(--primary-color);
    }

    .detail-label {
      font-size: 0.85rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .detail-value {
      font-weight: 600;
      font-size: 1.2rem;
    }

    .forecast-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 25px;
      width: 100%;
      margin-bottom: 30px;
    }

    .forecast-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 25px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .forecast-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.2);
    }

    .forecast-card.active {
      border: 2px solid var(--primary-light);
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 12px 24px rgba(0,0,0,0.25);
    }

    .forecast-date {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 15px;
      text-align: center;
    }

    .forecast-weather {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 15px;
    }

    .weather-icon {
      width: 70px;
      height: 70px;
    }

    .forecast-temp {
      font-size: 1.8rem;
      font-weight: 600;
      margin: 15px 0;
      color: var(--text-color);
    }

    .forecast-condition {
      font-size: 1rem;
      text-align: center;
      margin-bottom: 10px;
      color: var(--text-color);
    }

    .temp-range {
      display: flex;
      gap: 20px;
      margin-top: auto;
    }

    .temp-high, .temp-low {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .temp-high .temp-value {
      color: #e63946;
    }

    .temp-low .temp-value {
      color: #0077b6;
    }

    .temp-value {
      font-weight: 700;
      font-size: 1.3rem;
    }

    .temp-label {
      font-size: 0.85rem;
      opacity: 0.8;
      color: var(--text-color);
    }

    .hourly-forecast-container {
      width: 100%;
      margin-top: 20px;
      display: none;
    }

    .hourly-forecast-title {
      color: white;
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.5rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      font-weight: 600;
    }

    .hourly-forecast {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      padding: 15px 0;
      scrollbar-width: thin;
      scrollbar-color: var(--primary-color) rgba(255,255,255,0.1);
    }

    .hourly-forecast::-webkit-scrollbar {
      height: 8px;
    }

    .hourly-forecast::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .hourly-forecast::-webkit-scrollbar-thumb {
      background-color: var(--primary-color);
      border-radius: 10px;
    }

    .hour-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px 15px;
      min-width: 110px;
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .hour-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    .hour-time {
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-color);
    }

    .hour-temp {
      font-size: 1.3rem;
      font-weight: 700;
      margin: 8px 0;
      color: var(--text-color);
    }

    .hour-icon {
      width: 45px;
      height: 45px;
    }

    .hour-condition {
      font-size: 0.85rem;
      text-align: center;
      color: var(--text-color);
      margin-top: 5px;
    }

    .error-message {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: var(--border-radius);
      color: #d32f2f;
      text-align: center;
      box-shadow: var(--card-shadow);
      font-weight: 500;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin: 30px 0;
    }

    .weather-summary {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      flex: 1;
    }

    .feels-like {
      font-size: 1.1rem;
      color: var(--text-color);
      opacity: 0.9;
      margin-top: 5px;
    }

    .weather-condition {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 5px;
    }

    .last-updated {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.9);
      margin-top: 10px;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .current-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
        text-align: center;
      }

      .search-container {
        flex-direction: column;
        border-radius: var(--border-radius);
      }

      button {
        width: 100%;
        justify-content: center;
      }

      .current-main {
        flex-direction: column;
        text-align: center;
      }

      .current-left {
        flex-direction: column;
        align-items: center;
      }

      .current-temp {
        margin: 10px 0;
      }

      .weather-summary {
        align-items: center;
        text-align: center;
      }

      .forecast-container {
        grid-template-columns: 1fr;
      }

      .hour-card {
        min-width: 90px;
        padding: 15px 10px;
      }
    }

    /* Accessibility improvements */
    button:focus, input:focus {
      outline: 2px solid var(--primary-light);
      outline-offset: 2px;
    }

    /* Animation for cards */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .current-weather, .forecast-card, .hour-card {
      animation: fadeIn 0.5s ease-out forwards;
    }

    .forecast-card:nth-child(2) {
      animation-delay: 0.1s;
    }

    .forecast-card:nth-child(3) {
      animation-delay: 0.2s;
    }
  </style>
</head>
<body class="daytime">
  <div class="weather-overlay" id="weatherEffects"></div>
  <div class="container">
    <h1><i class="fas fa-cloud-sun"></i> Weather Forecast</h1>
    <div class="search-container">
      <input type="text" id="cityInput" placeholder="Enter city name..." aria-label="City name">
      <button onclick="getWeather()" aria-label="Search weather">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
    <div id="result">
      <div class="loading">
        <p>Search for a city to see the weather forecast</p>
      </div>
    </div>
  </div>

  <script>
    let currentWeatherData = null;
    let selectedDateIndex = 0;
    let lastUpdatedTime = null;

    function createClouds(count, type = 'normal') {
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Clear existing clouds but keep other effects
      const existingClouds = weatherEffects.querySelectorAll('.cloud');
      existingClouds.forEach(cloud => cloud.remove());
      
      for (let i = 0; i < count; i++) {
        const cloud = document.createElement('div');
        cloud.className = 'cloud';
        
        // Random cloud properties
        const size = type === 'heavy' ? Math.random() * 200 + 100 : Math.random() * 150 + 50;
        const opacity = type === 'heavy' ? Math.random() * 0.7 + 0.3 : Math.random() * 0.5 + 0.3;
        const top = Math.random() * 60;
        const duration = Math.random() * 100 + 100;
        const delay = Math.random() * -100;
        const blur = type === 'heavy' ? 25 : 15;
        
        cloud.style.width = `${size}px`;
        cloud.style.height = `${size * 0.6}px`;
        cloud.style.opacity = opacity;
        cloud.style.top = `${top}%`;
        cloud.style.left = `${Math.random() * 20 - 20}%`;
        cloud.style.animationDuration = `${duration}s`;
        cloud.style.animationDelay = `${delay}s`;
        cloud.style.filter = `blur(${blur}px)`;
        
        weatherEffects.appendChild(cloud);
      }
    }

    function createRain(intensity = 'moderate') {
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Clear existing rain but keep other effects
      const existingRain = weatherEffects.querySelector('.rain');
      if (existingRain) existingRain.remove();
      
      const rainContainer = document.createElement('div');
      rainContainer.className = 'rain';
      
      const dropCount = intensity === 'heavy' ? 200 : intensity === 'light' ? 50 : 100;
      const dropSize = intensity === 'heavy' ? 3 : intensity === 'light' ? 1 : 2;
      const dropLength = intensity === 'heavy' ? 40 : intensity === 'light' ? 20 : 30;
      
      for (let i = 0; i < dropCount; i++) {
        const drop = document.createElement('div');
        drop.className = 'drop';
        
        const left = Math.random() * 100;
        const duration = Math.random() * 0.5 + 0.5;
        const delay = Math.random() * 2;
        const height = Math.random() * dropLength + dropLength/2;
        
        drop.style.left = `${left}%`;
        drop.style.animationDuration = `${duration}s`;
        drop.style.animationDelay = `${delay}s`;
        drop.style.height = `${height}px`;
        drop.style.width = `${dropSize}px`;
        
        rainContainer.appendChild(drop);
      }
      
      weatherEffects.appendChild(rainContainer);
    }

    function createSnow(intensity = 'moderate') {
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Clear existing snow but keep other effects
      const existingSnow = weatherEffects.querySelector('.snow');
      if (existingSnow) existingSnow.remove();
      
      const snowContainer = document.createElement('div');
      snowContainer.className = 'snow';
      
      const flakeCount = intensity === 'heavy' ? 150 : intensity === 'light' ? 50 : 100;
      const minSize = intensity === 'heavy' ? 3 : intensity === 'light' ? 1 : 2;
      const maxSize = intensity === 'heavy' ? 8 : intensity === 'light' ? 4 : 6;
      
      for (let i = 0; i < flakeCount; i++) {
        const flake = document.createElement('div');
        flake.className = 'flake';
        
        const size = Math.random() * (maxSize - minSize) + minSize;
        const left = Math.random() * 100;
        const duration = Math.random() * 10 + 5;
        const delay = Math.random() * 5;
        const opacity = Math.random() * 0.7 + 0.3;
        const sway = Math.random() * 30 + 10;
        
        flake.style.width = `${size}px`;
        flake.style.height = `${size}px`;
        flake.style.left = `${left}%`;
        flake.style.animationDuration = `${duration}s`;
        flake.style.animationDelay = `${delay}s`;
        flake.style.opacity = opacity;
        flake.style.animationName = `snowfall${Math.random() > 0.5 ? '2' : ''}`;
        
        // Add sway animation
        document.styleSheets[0].insertRule(`
          @keyframes snowfall2 {
            0% { transform: translateY(-10px) translateX(0) rotate(0deg); }
            100% { transform: translateY(100vh) translateX(${sway}px) rotate(360deg); }
          }
        `, document.styleSheets[0].cssRules.length);
        
        snowContainer.appendChild(flake);
      }
      
      weatherEffects.appendChild(snowContainer);
    }

    function createThunderstorm() {
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Create heavy rain
      createRain('heavy');
      
      // Add dark clouds
      createClouds(10, 'heavy');
      
      // Add lightning effect
      const lightning = document.createElement('div');
      lightning.className = 'lightning';
      weatherEffects.appendChild(lightning);
      
      // Random lightning flashes
      function flash() {
        const intensity = Math.random() * 0.4 + 0.6;
        lightning.style.opacity = intensity.toString();
        
        setTimeout(() => {
          lightning.style.opacity = '0';
          setTimeout(() => {
            if (Math.random() > 0.7) { // 30% chance of double flash
              lightning.style.opacity = (intensity * 0.7).toString();
              setTimeout(() => {
                lightning.style.opacity = '0';
              }, 50);
            }
          }, 50);
        }, 100);
        
        setTimeout(flash, Math.random() * 8000 + 3000); // Flash every 3-11 seconds
      }
      
      setTimeout(flash, Math.random() * 5000 + 2000);
    }

    function createFog(intensity = 'moderate') {
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Clear existing fog but keep other effects
      const existingFog = weatherEffects.querySelector('.fog');
      if (existingFog) existingFog.remove();
      
      const fogContainer = document.createElement('div');
      fogContainer.className = 'fog';
      
      const fogCount = intensity === 'heavy' ? 15 : intensity === 'light' ? 5 : 10;
      const maxOpacity = intensity === 'heavy' ? 0.3 : intensity === 'light' ? 0.1 : 0.2;
      
      for (let i = 0; i < fogCount; i++) {
        const fogCloud = document.createElement('div');
        fogCloud.className = 'fog-cloud';
        
        const width = Math.random() * 400 + 200;
        const height = Math.random() * 150 + 50;
        const top = Math.random() * 100;
        const duration = Math.random() * 100 + 100;
        const delay = Math.random() * -100;
        const opacity = Math.random() * maxOpacity + 0.05;
        const blur = intensity === 'heavy' ? 40 : intensity === 'light' ? 20 : 30;
        
        fogCloud.style.width = `${width}px`;
        fogCloud.style.height = `${height}px`;
        fogCloud.style.top = `${top}%`;
        fogCloud.style.left = `${Math.random() * 20 - 20}%`;
        fogCloud.style.animationDuration = `${duration}s`;
        fogCloud.style.animationDelay = `${delay}s`;
        fogCloud.style.opacity = opacity;
        fogCloud.style.filter = `blur(${blur}px)`;
        
        fogContainer.appendChild(fogCloud);
      }
      
      weatherEffects.appendChild(fogContainer);
    }

    function createStars() {
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Clear existing stars but keep other effects
      const existingStars = weatherEffects.querySelector('.stars');
      if (existingStars) existingStars.remove();
      
      const starsContainer = document.createElement('div');
      starsContainer.className = 'stars';
      
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        
        const size = Math.random() * 2 + 1;
        const left = Math.random() * 100;
        const top = Math.random() * 100;
        const duration = Math.random() * 3 + 1;
        const delay = Math.random() * 5;
        
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${left}%`;
        star.style.top = `${top}%`;
        star.style.animationDuration = `${duration}s`;
        star.style.animationDelay = `${delay}s`;
        
        starsContainer.appendChild(star);
      }
      
      weatherEffects.appendChild(starsContainer);
    }

    function createSunMoon(isDay) {
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Clear existing sun/moon but keep other effects
      const existingSunMoon = weatherEffects.querySelector('.sun-moon');
      if (existingSunMoon) existingSunMoon.remove();
      
      const sunMoon = document.createElement('div');
      sunMoon.className = `sun-moon ${isDay ? 'sun' : 'moon'}`;
      
      const size = isDay ? 100 : 80;
      const left = 20 + Math.random() * 20;
      const top = 20 + Math.random() * 20;
      
      sunMoon.style.width = `${size}px`;
      sunMoon.style.height = `${size}px`;
      sunMoon.style.left = `${left}%`;
      sunMoon.style.top = `${top}%`;
      
      weatherEffects.appendChild(sunMoon);
    }

    function setTimeBasedBackground(hour) {
      // Remove all time classes first
      document.body.classList.remove('morning', 'daytime', 'evening', 'night');
      
      if (hour >= 5 && hour < 9) {
        // Morning (5am - 9am)
        document.body.classList.add('morning');
      } else if (hour >= 9 && hour < 17) {
        // Daytime (9am - 5pm)
        document.body.classList.add('daytime');
      } else if (hour >= 17 && hour < 20) {
        // Evening (5pm - 8pm)
        document.body.classList.add('evening');
      } else {
        // Night (8pm - 5am)
        document.body.classList.add('night');
      }
    }

    function setWeatherEffects(condition, isDay) {
      const conditionText = condition.toLowerCase();
      const weatherEffects = document.getElementById('weatherEffects');
      
      // Clear all existing effects
      weatherEffects.innerHTML = '';
      
      // Remove all weather classes first
      document.body.classList.remove('rainy', 'cloudy', 'snowy', 'thunderstorm', 'foggy', 'clear-night');
      
      if (conditionText.includes('rain') || conditionText.includes('drizzle')) {
        if (conditionText.includes('thunder') || conditionText.includes('storm')) {
          document.body.classList.add('thunderstorm');
          createThunderstorm();
        } else {
          document.body.classList.add('rainy');
          const intensity = conditionText.includes('light') ? 'light' : conditionText.includes('heavy') ? 'heavy' : 'moderate';
          createRain(intensity);
          createClouds(8, 'heavy');
        }
      } else if (conditionText.includes('snow') || conditionText.includes('sleet') || conditionText.includes('ice')) {
        document.body.classList.add('snowy');
        const intensity = conditionText.includes('light') ? 'light' : conditionText.includes('heavy') ? 'heavy' : 'moderate';
        createSnow(intensity);
      } else if (conditionText.includes('fog') || conditionText.includes('mist') || conditionText.includes('haze')) {
        document.body.classList.add('foggy');
        const intensity = conditionText.includes('light') ? 'light' : conditionText.includes('heavy') ? 'heavy' : 'moderate';
        createFog(intensity);
      } else if (conditionText.includes('cloud') || conditionText.includes('overcast')) {
        document.body.classList.add('cloudy');
        const cloudCount = conditionText.includes('partly') ? 5 : conditionText.includes('overcast') ? 10 : 8;
        createClouds(cloudCount, conditionText.includes('overcast') ? 'heavy' : 'normal');
      } else {
        // Sunny/clear
        if (isDay) {
          createSunMoon(true);
          createClouds(2); // Few clouds for sunny weather
        } else {
          document.body.classList.add('clear-night');
          createStars();
          createClouds(1); // Very few clouds for clear night
          createSunMoon(false);
        }
      }
    }

    function getWeatherIcon(condition) {
      const conditionText = condition.toLowerCase();
      if (conditionText.includes('sunny') || conditionText.includes('clear')) {
        const hour = new Date().getHours();
        return hour > 18 || hour < 6 ? 'fa-moon' : 'fa-sun';
      } else if (conditionText.includes('cloud')) {
        return 'fa-cloud';
      } else if (conditionText.includes('rain')) {
        return 'fa-cloud-rain';
      } else if (conditionText.includes('snow')) {
        return 'fa-snowflake';
      } else if (conditionText.includes('thunder')) {
        return 'fa-bolt';
      } else if (conditionText.includes('fog') || conditionText.includes('mist')) {
        return 'fa-smog';
      }
      return 'fa-cloud-sun';
    }

    function showHourlyForecast(dateIndex) {
      if (!currentWeatherData) return;
      
      selectedDateIndex = dateIndex;
      const forecastDay = currentWeatherData.forecast.forecastday[dateIndex];
      const hourlyContainer = document.querySelector('.hourly-forecast');
      
      // Update active state of forecast cards
      document.querySelectorAll('.forecast-card').forEach((card, index) => {
        if (index === dateIndex) {
          card.classList.add('active');
        } else {
          card.classList.remove('active');
        }
      });
      
      // Clear previous hourly data
      hourlyContainer.innerHTML = '';
      
      // Add current hours
      forecastDay.hour.forEach(hourData => {
        const hourTime = new Date(hourData.time);
        const hourString = hourTime.toLocaleTimeString([], {hour: '2-digit'});
        const isCurrentHour = new Date().getHours() === hourTime.getHours() && 
                             new Date().getDate() === hourTime.getDate();
        
        const hourCard = document.createElement('div');
        hourCard.className = `hour-card ${isCurrentHour ? 'active' : ''}`;
        hourCard.innerHTML = `
          <div class="hour-time">${hourString}</div>
          <img class="hour-icon" src="https:${hourData.condition.icon}" alt="${hourData.condition.text}" loading="lazy">
          <div class="hour-temp">${Math.round(hourData.temp_c)}°C</div>
          <div class="hour-condition">${hourData.condition.text}</div>
          ${hourData.chance_of_rain > 0 ? `<div style="font-size:0.8rem;color:#0077b6;margin-top:5px;">☔ ${hourData.chance_of_rain}%</div>` : ''}
        `;
        hourlyContainer.appendChild(hourCard);
      });
      
      // Show hourly container
      document.querySelector('.hourly-forecast-container').style.display = 'block';
    }

    function formatWindSpeed(speedKph, windDir) {
      // Convert km/h to m/s for Beaufort scale
      const speedMs = speedKph / 3.6;
      let beaufort = 0;
      let description = '';
      
      if (speedMs < 0.5) {
        beaufort = 0;
        description = 'Calm';
      } else if (speedMs < 1.5) {
        beaufort = 1;
        description = 'Light air';
      } else if (speedMs < 3.3) {
        beaufort = 2;
        description = 'Light breeze';
      } else if (speedMs < 5.5) {
        beaufort = 3;
        description = 'Gentle breeze';
      } else if (speedMs < 7.9) {
        beaufort = 4;
        description = 'Moderate breeze';
      } else if (speedMs < 10.7) {
        beaufort = 5;
        description = 'Fresh breeze';
      } else if (speedMs < 13.8) {
        beaufort = 6;
        description = 'Strong breeze';
      } else if (speedMs < 17.1) {
        beaufort = 7;
        description = 'Near gale';
      } else if (speedMs < 20.7) {
        beaufort = 8;
        description = 'Gale';
      } else if (speedMs < 24.4) {
        beaufort = 9;
        description = 'Strong gale';
      } else if (speedMs < 28.4) {
        beaufort = 10;
        description = 'Storm';
      } else if (speedMs < 32.6) {
        beaufort = 11;
        description = 'Violent storm';
      } else {
        beaufort = 12;
        description = 'Hurricane';
      }
      
      return `${speedKph} km/h (${description} from ${windDir})`;
    }

    function getUVIndexDescription(uv) {
      if (uv <= 2) return 'Low';
      if (uv <= 5) return 'Moderate';
      if (uv <= 7) return 'High';
      if (uv <= 10) return 'Very High';
      return 'Extreme';
    }

    async function getWeather() {
      const city = document.getElementById('cityInput').value.trim();
      if (!city) {
        document.getElementById('result').innerHTML = `
          <div class="error-message">
            <i class="fas fa-exclamation-circle"></i> Please enter a city name
          </div>
        `;
        return;
      }

      const apiKey = 'ce36ef0dd253436489b133205251605'; // Replace with your WeatherAPI key
      const url = `https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${encodeURIComponent(city)}&days=3&aqi=no&alerts=no`;

      try {
        document.getElementById('result').innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading weather data for ${city}...</p>
          </div>
        `;

        const response = await fetch(url);
        const data = await response.json();

        if (data.error) {
          document.getElementById('result').innerHTML = `
            <div class="error-message">
              <i class="fas fa-exclamation-triangle"></i> ${data.error.message}
            </div>
          `;
          return;
        }

        if (data.location) {
          currentWeatherData = data;
          lastUpdatedTime = new Date();
          
          // Get local time from the API response
          const localTime = new Date(data.location.localtime);
          const localHour = localTime.getHours();
          
          // Set background based on time of day
          setTimeBasedBackground(localHour);
          
          // Set weather effects
          setWeatherEffects(data.current.condition.text);

          // Format current date
          const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
          const formattedDate = localTime.toLocaleDateString('en-US', options);

          // Format wind information
          const windInfo = formatWindSpeed(data.current.wind_kph, data.current.wind_dir);
          
          let output = `
            <div class="location-title">
              ${data.location.name}, ${data.location.country}
              <div style="font-size: 1rem; margin-top: 5px;">
                ${formattedDate} • Local Time: ${localTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
              </div>
            </div>

            <div class="current-weather">
              <div class="current-main">
                <div class="current-left">
                  <img class="weather-icon-large" src="https:${data.current.condition.icon}" alt="${data.current.condition.text}" loading="lazy">
                  <div class="current-temp">${Math.round(data.current.temp_c)}°C</div>
                </div>
                <div class="weather-summary">
                  <div class="weather-condition">${data.current.condition.text}</div>
                  <div class="feels-like">Feels like ${Math.round(data.current.feelslike_c)}°C</div>
                  <div style="margin-top: 15px;">
                    <div>Humidity: ${data.current.humidity}%</div>
                    <div>Wind: ${windInfo}</div>
                    ${data.current.precip_mm > 0 ? `<div>Precipitation: ${data.current.precip_mm}mm</div>` : ''}
                  </div>
                </div>
              </div>

              <div class="current-details">
                <div class="detail-card">
                  <i class="fas fa-wind"></i>
                  <div class="detail-label">Wind</div>
                  <div class="detail-value">${windInfo}</div>
                </div>
                <div class="detail-card">
                  <i class="fas fa-tint"></i>
                  <div class="detail-label">Humidity</div>
                  <div class="detail-value">${data.current.humidity}%</div>
                </div>
                <div class="detail-card">
                  <i class="fas fa-cloud-rain"></i>
                  <div class="detail-label">Precipitation</div>
                  <div class="detail-value">${data.current.precip_mm}mm</div>
                </div>
                <div class="detail-card">
                  <i class="fas fa-eye"></i>
                  <div class="detail-label">Visibility</div>
                  <div class="detail-value">${data.current.vis_km} km</div>
                </div>
                <div class="detail-card">
                  <i class="fas fa-sun"></i>
                  <div class="detail-label">UV Index</div>
                  <div class="detail-value">${data.current.uv} (${getUVIndexDescription(data.current.uv)})</div>
                </div>
                <div class="detail-card">
                  <i class="fas fa-compress-alt"></i>
                  <div class="detail-label">Pressure</div>
                  <div class="detail-value">${data.current.pressure_mb} mb</div>
                </div>
              </div>
            </div>

            <h2 style="color: white; text-align: center; margin: 30px 0 20px;">3-Day Forecast</h2>
            <div class="forecast-container">
          `;

          data.forecast.forecastday.forEach((day, index) => {
            const date = new Date(day.date);
            const options = { weekday: 'long', month: 'short', day: 'numeric' };
            const formattedDate = date.toLocaleDateString('en-US', options);
            const isToday = new Date().getDate() === date.getDate();
            
            output += `
              <div class="forecast-card ${isToday ? 'active' : ''}" onclick="showHourlyForecast(${index})" aria-label="Forecast for ${formattedDate}">
                <div class="forecast-date">${formattedDate}${isToday ? ' (Today)' : ''}</div>
                <div class="forecast-weather">
                  <img class="weather-icon" src="https:${day.day.condition.icon}" alt="${day.day.condition.text}" loading="lazy">
                  <div class="forecast-condition">${day.day.condition.text}</div>
                  <div class="forecast-temp">${Math.round(day.day.avgtemp_c)}°C</div>
                </div>
                <div class="temp-range">
                  <div class="temp-high">
                    <div class="temp-value">${Math.round(day.day.maxtemp_c)}°</div>
                    <div class="temp-label">High</div>
                  </div>
                  <div class="temp-low">
                    <div class="temp-value">${Math.round(day.day.mintemp_c)}°</div>
                    <div class="temp-label">Low</div>
                  </div>
                </div>
                ${day.day.daily_chance_of_rain > 0 ? 
                  `<div style="margin-top:10px;color:#0077b6;font-size:0.9rem;">
                    <i class="fas fa-umbrella"></i> ${day.day.daily_chance_of_rain}% chance
                  </div>` : ''}
              </div>
            `;
          });

          output += `</div>
            <div class="hourly-forecast-container">
              <div class="hourly-forecast-title">Hourly Forecast</div>
              <div class="hourly-forecast"></div>
            </div>
            <div class="last-updated">
              Last updated: ${lastUpdatedTime.toLocaleTimeString()}
            </div>
          `;
          
          document.getElementById('result').innerHTML = output;
          
          // Show hourly forecast for today by default
          showHourlyForecast(0);
        }
      } catch (error) {
        console.error('Error fetching weather data:', error);
        document.getElementById('result').innerHTML = `
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i> Network error occurred. Please check your connection and try again.
          </div>
        `;
      }
    }

    // Set initial background based on local time
    const now = new Date();
    setTimeBasedBackground(now.getHours());
    createClouds(3); // Default clouds

    // Add event listener for Enter key
    document.getElementById('cityInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        getWeather();
      }
    });

    // Focus the input field on page load
    window.onload = function() {
      document.getElementById('cityInput').focus();
    };

    // Add click listener to document to close hourly forecast when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.forecast-card') && !e.target.closest('.hourly-forecast-container')) {
        document.querySelector('.hourly-forecast-container').style.display = 'none';
        document.querySelectorAll('.forecast-card').forEach(card => {
          card.classList.remove('active');
        });
      }
    });
  </script>
</body>
</html>